%table
  %tr
    %th.centered Order #
    %th Date
    %th{ :colspan => 2 } Quantity / Product
    %th.centered Status
    %th.currency Total
  - @order_details.each do |od|
    - order = od.order
    - res = od.reservation
    %tr
      %td.centered= link_to od, order_order_detail_path(order, od)
      %td=h human_datetime(order.ordered_at)
      %td.centered=h od.quantity
      %td
        %ul
          %li
            - product_name = (od.bundle ? "#{h od.bundle} &mdash; " : '') + h(od.product)
            = "#{h od.product.facility.abbreviation} / #{product_name}".html_safe
            - unless res.nil?
              - if res.can_edit?
                %li.indented= link_to od.reservation, edit_order_order_detail_reservation_path(order, od, od.reservation)
              - else
                %li.indented= link_to od.reservation, order_order_detail_reservation_path(order, od, od.reservation)
            - unless od.note.blank?
              %li
                %i=h "Note: #{od.note}"
      %td.centered=h od.order_status.name
      %td.currency
        - if od.cost_estimated?
          %span.estimated_cost
            = show_estimated_total(od)
        - elsif od.price_policy.nil?
          Unassigned
        - else
          %span.actual_cost
            = show_actual_total(od)

%p.footnote
  %span.estimated_cost
    Orange
  totals are estimates.
  %span.actual_cost
    Green
  totals are final. Pricing will be assigned to transactions with unassigned totals.
= will_paginate(@order_details)
